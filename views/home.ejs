<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
<link rel="stylesheet" href="/css/home.css">
<div class="main-container">

   <h1>Codeial</h1>

   <section id="feed-posts">
      <h4>
         Posts
      </h4>

      <!--show the form only if user is logged input-->
      
      <% if (locals.user) {%>

         <form action="/posts/createPost" id="new-post-form" method="POST">
            <textarea name="content" id="" cols="30" rows="3" placeholder="Add your Question here...." required></textarea>
            <input type="submit" value="Post">
         </form>

      <%}%>

      <div class="post-list-container">
         
            <% for(post of posts){ %>  <!--itirating through all items of posts-->

               <p>
                  
                  <%= post.content%>
                  <%= post.user.name%>
                  <%=post.user.email%>
                  <!--<%=post.user.createdAt%>-->

               </p>

               <div class="delete-btn">
                  <a href="/posts/deletePost/<%= post.id%>"><i class="fa fa-solid fa-trash" style="color: #02353c;"></i></a>
               </div>

               <div class="post-comments">
                  <% if (locals.user) { %> <!--this makes sure that the user can enter a comment only after they are logged in , since local.user is set up only after authentication is done by passport.js-->

                     <form action="/comments/create" method="POST">
                        <input type="text" name="content" placeholder="Leave a comment here...." required>
                        <input type="hidden" name="post" value="<%= post._id %>"> <!--this is a hidden input that will send the post id-->
                        <input type="submit" value="Comment">
                     </form>
   
                  <%}%>
               </div>

               <div class="post-comments-list">
                  <div id="post-comments-<%= post._id%>">
                     <% for (comment of post.comments){%>

                        <p>
                           <%= comment.content%>
                           <br>
                           <small>
                              <%= comment.user.name %>
                           </small>
                        </p>
                     <%}%>
                     </div>
               </div>
               

            <%}%>
         
      </div>

   </section>
   

</div>
   
   